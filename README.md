README POM Matlab processing

This repository contains MATLAB code to generate 3D panoramic optical mapping (POM) data. Please see the POMprocessing file for instructions on how to utilize the Rhythm code generated by the Efimov laboratory to generate 2D activation, APD, and phase maps.

Our 3D POM algorithm as described in Melki et al. is detailed in the file "PanoramicOpticalMapping_UserGuidePierre".

RhythmDevelopment1 contains the modified Rhythm code from the Efimov laboratory required to generate 2D activation, APD, and phase maps. PanoramicImagingGUIv10 contains the 3D panoramic optical mapping code. Registration-Thickness contains code to coregister micro-CT and 3D POM data.

Code for machine learning segmentation of microCT data is held in separate GitHub repository "MicroCTsegmentation"

Note: this code requires installation of Matlab image processing toolbox 
Please ensure all folders and subfolders of the downloaded file are added to the path

Quick instructions for sample data (please see more detailed instructions as above)

Under PanoramicImagingGUIv10 -> Open PanoramicImaging_gui.m and Run

Choose “Select an existing calibration file” - this file is generated from the dice image acquired with each heart 
•	A pre-generated calibration file is provided for convenience - alternatively a new file could be generated as described from calibration dice images as described in the user guide 

Choose “select an existing silhouette” - this file is also pre-generated for convenience given the file size of uploading heart images at every 5 degrees, but can be newly generated as well

Await the appearance of the 3D silhouette in the bottom left view window off the GUI

Proceed to projection of optical data maps onto the silhouette – for new data 2D APD maps calculated from the Rhythm program are utilized but a sample pre-generated example is provided

Select “load existing map” and choose the file “IMG0223-023APDMapProjected” 

The 3D APD map can be visualized in the bottom right viewing window, and rotated manually by selecting the “Rotate 3D” icon in the top left of the GUI, or automatically by selecting “Play Movie”. Elevation angle and colobar can also be adjusted. Optimal viewing is performed however by selecting “save data” and opening the resulting dataset in Amira for 3D visualization (see methods of manuscript).

The process can be repeated for activation maps, and phase maps (except for phase movies with last frame set to number of frames of data desired- typically generated 100 frames at a time with 1 frame representing 1 ms).


